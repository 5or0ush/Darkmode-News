<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cyber News</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  </head>
<body>
  <header>
  <div class="wrap" style="display:flex; justify-content: space-between; align-items: center; gap:30px;">
    <strong>Cyber News</strong>
    <form id="search-form" method="get" action="/" style="flex:1; display:flex; justify-content:center;">
      <input type="text" name="q" placeholder="Search..." class="search-input" value="{{ request.args.get('q','') }}">
      <button type="submit" class="search-btn">Go</button>
    </form>
    <form id="lang-form" method="get">
     
      <select class="lang-select" name="lang" onchange="this.form.submit()">
    <option value="en" {% if session.get('lang')=='en' %}selected{% endif %}>English</option>
    <option value="de" {% if session.get('lang')=='de' %}selected{% endif %}>Deutsch</option>
    <option value="fr" {% if session.get('lang')=='fr' %}selected{% endif %}>Français</option>
    <option value="ar" {% if session.get('lang')=='ar' %}selected{% endif %}>عربي</option>
    <option value="ru" {% if session.get('lang')=='ru' %}selected{% endif %}>русский</option>
    <option value="it" {% if session.get('lang')=='it' %}selected{% endif %}>Italiano</option>
    </select>
    </form>
  </div>
</header>
  <main class="wrap">
    <div class="grid">
      {% for a in articles %}
      <article class="card">
        {% if a.urlToImage %}
          <img class="thumb" src="{{ a.urlToImage }}" alt="" loading="lazy" onerror="this.style.display='none'">
        {% else %}
          <div class="thumb"></div>
        {% endif %}
        <h3>
          <a href="{{ a.url }}" target="_blank" rel="noopener"
             onclick="fetch('/track?url={{ a.url | urlencode }}&title={{ (a.title or '') | urlencode }}&description={{ (a.description or '') | urlencode }}&source={{ (a.source.name or 'Unknown') | urlencode }}&publishedAt={{ (a.publishedAt or '') | urlencode }}')">
            {{ a.title }}
          </a>
        </h3>
        <div class="meta">
          <span class="badge">{{ a.source.name or "Unknown" }}</span>
          <span class="badge">{{ (a.publishedAt or "")[:10] }}</span>
        </div>
        <p class="desc">{{ a.description or "" }}</p>
      </article>
      {% endfor %}
    </div>
    {% if not articles %}
      <p>No articles. Check API key or quota.</p>
    {% endif %}
  </main>
  <div class="wrap" style="display:flex; justify-content: space-between; align-items: center; gap:30px;">
    <h2>Most viewed articles</h2>
  </div>

  <main class="wrap">
    <div class="grid">
      
      {% for i in most_visited %}
      <article class="card">
        <h3>
          <a href="{{ i.url }}" target="_blank" rel="noopener" onclick="fetch('/track?url={{ i.url }}')">
            {{ i.title }}
          </a>
        </h3>
        <div class="meta">
          <span class="badge">{{ i.source or "Unknown" }}</span>
          {% if i.publishedAt %}<span class="badge">{{ i.publishedAt[:10] }}</span>{% endif %}
          {% if i.count is not none %}<span class="badge">{{ i.count }} visits</span>{% endif %}
        </div>
        <p class="desc">{{ i.description or "" }}</p>
      </article>
      {% endfor %}
    </div>
    {% if not most_visited %}
      <p>No articles. Check API key or quota.</p>
    {% endif %}
  </main>
</body>
</html>