<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cyber News</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  </head>
<body>
  <header>
  <div class="wrap" style="display:flex; justify-content: space-between; align-items: center; gap:30px;">
    <strong>Cyber News</strong>
    <form id="search-form" method="get" action="/" style="flex:1; display:flex; justify-content:center;">
      <input type="text" name="q" placeholder="Search..." class="search-input" value="{{ request.args.get('q','') }}">
      <button type="submit" class="search-btn">Go</button>
    </form>
    <form id="lang-form" method="get">
     
      <select name="lang" onchange="this.form.submit()">
    <option value="en" {% if session.get('lang')=='en' %}selected{% endif %}>English</option>
    <option value="de" {% if session.get('lang')=='de' %}selected{% endif %}>Deutsch</option>
    <option value="fr" {% if session.get('lang')=='fr' %}selected{% endif %}>Français</option>
    <option value="ar" {% if session.get('lang')=='ar' %}selected{% endif %}>عربي</option>
    <option value="ru" {% if session.get('lang')=='ru' %}selected{% endif %}>русский</option>
    <option value="it" {% if session.get('lang')=='it' %}selected{% endif %}>Italiano</option>
    </select>
    </form>
  </div>
</header>
  <main class="wrap">
    <div class="grid">
      {% for a in articles %}
      <article class="card">
        
        <h3>
          <a href="{{ a.url }}" target="_blank" rel="noopener"
            onclick="fetch('/track?url={{ a.url | urlencode }}&title={{ a.title | urlencode }}&description={{ a.description | urlencode }}&source={{ a.source.name | urlencode }}&publishedAt={{ a.publishedAt | urlencode }}')">
            {{ a.title }}
          </a>
        </h3>
        <div class="meta">{{ a.source.name or "Unknown" }} · {{ a.publishedAt[:10] }}</div>
        <p class="desc">{{ a.description or "" }}</p>
      </article>
      {% endfor %}
    </div>
    {% if not articles %}
      <p>No articles. Check API key or quota.</p>
    {% endif %}
  </main>
  <div class="wrap" style="display:flex; justify-content: space-between; align-items: center; gap:30px;">
    <h2>Most viewed articles</h2>
  </div>

  <main class="wrap">
    <div class="grid">
      
      {% for i in most_visited %}
      <article class="card">
        
        <h3><a href="{{ i.url }}" target="_blank" rel="noopener" onclick="fetch('/track?url={{ i.url }}')">{{ i.title }} </h3></a>
        <div class="meta">{{ i.source or "Unknown" }} · {{ i.publishedAt[:10] }} · ({{ i.count }} visits)</div>
        <p class="desc">{{ i.description or "" }}</p>
      </article>
      {% endfor %}
    </div>
    {% if not most_visited %}
      <p>No articles. Check API key or quota.</p>
    {% endif %}
  </main>
</body>
</html>